<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PonzuCollectiva — MemeRevo · Burn Memes to ETH · Tiered Collectiva</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg: #0d0b0a;
      --bg-panel: #161210;
      --bg-card: #1c1816;
      --border: #2e2824;
      --border-soft: #221e1b;
      --inferno: #ff4d22;
      --inferno-dim: #e63d14;
      --ponzu: #f5a623;
      --ponzu-dim: #d4921e;
      --mint: #22c997;
      --mint-dim: #1aa87a;
      --text: #f0ebe6;
      --text-dim: #8c847a;
      --glow-inferno: rgba(255, 77, 34, 0.15);
      --glow-ponzu: rgba(245, 166, 35, 0.12);
      --radius: 12px;
      --radius-sm: 8px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      background-image: radial-gradient(ellipse 90% 60% at 50% -10%, rgba(255, 77, 34, 0.08), transparent 50%),
        radial-gradient(ellipse 70% 40% at 80% 60%, rgba(245, 166, 35, 0.06), transparent 40%);
    }
    .app { max-width: 960px; margin: 0 auto; padding: 1.5rem 1.25rem; }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem 0 1.5rem;
      border-bottom: 1px solid var(--border-soft);
      margin-bottom: 1.5rem;
    }
    .logo { font-weight: 700; font-size: 1.75rem; color: var(--ponzu); letter-spacing: 0.03em; }
    .tagline { font-size: 0.8rem; color: var(--text-dim); margin-top: 0.25rem; }
    .header-right { display: flex; align-items: center; gap: 0.6rem; flex-wrap: wrap; }
    .wallet-addr { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--mint); max-width: 140px; overflow: hidden; text-overflow: ellipsis; }
    .contract-in { width: 220px; padding: 0.5rem 0.7rem; font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; background: var(--bg-panel); border: 1px solid var(--border); color: var(--text); border-radius: var(--radius-sm); }
    .btn {
      font-family: 'Outfit', sans-serif;
      font-weight: 600;
      padding: 0.55rem 1rem;
      border: 1px solid var(--border);
      background: var(--bg-panel);
      color: var(--text);
      cursor: pointer;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
    }
    .btn:hover { border-color: var(--ponzu-dim); color: var(--ponzu); }
    .btn.primary { background: var(--inferno-dim); border-color: var(--inferno); color: #fff; }
    .btn.primary:hover { box-shadow: 0 0 20px var(--glow-inferno); }
    .btn.ponzu { border-color: var(--ponzu-dim); color: var(--ponzu); }
    .btn.ponzu:hover { box-shadow: 0 0 16px var(--glow-ponzu); }
    .btn.small { padding: 0.4rem 0.75rem; font-size: 0.85rem; }

    .hero {
      text-align: center;
      padding: 2rem 1.25rem;
      background: linear-gradient(180deg, var(--bg-card) 0%, transparent 100%);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius);
      margin-bottom: 1.5rem;
    }
    .hero h1 { font-size: 1.6rem; font-weight: 700; color: var(--text); margin-bottom: 0.5rem; }
    .hero p { color: var(--text-dim); font-size: 0.95rem; max-width: 42ch; margin: 0 auto; }

    .stats-row { display: flex; flex-wrap: wrap; gap: 0.85rem; margin-bottom: 1.5rem; }
    .stat-card {
      flex: 1;
      min-width: 140px;
      padding: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-sm);
    }
    .stat-card .label { font-size: 0.72rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 0.3rem; }
    .stat-card .value { font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; color: var(--inferno); }
    .stat-card .value.ponzu { color: var(--ponzu); }
    .stat-card .value.mint { color: var(--mint); }

    .tabs { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-bottom: 1.1rem; }
    .tab {
      padding: 0.55rem 1rem;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      color: var(--text-dim);
      cursor: pointer;
      border-radius: var(--radius-sm);
      font-size: 0.88rem;
      font-weight: 500;
    }
    .tab:hover { color: var(--text); }
    .tab.active { border-color: var(--ponzu-dim); color: var(--ponzu); background: var(--glow-ponzu); }

    .panel { display: none; }
    .panel.visible { display: block; }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius);
      padding: 1.25rem;
      margin-bottom: 1.1rem;
    }
    .card h3 { font-size: 1.05rem; margin-bottom: 0.7rem; color: var(--inferno-dim); font-weight: 600; }
    .card h4 { font-size: 0.9rem; margin: 1rem 0 0.5rem; color: var(--text-dim); font-weight: 500; }
    label { display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.3rem; }
    .input, select {
      width: 100%;
      padding: 0.55rem 0.7rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: var(--radius-sm);
      margin-bottom: 0.55rem;
    }
    .input:focus, select:focus { outline: none; border-color: var(--ponzu-dim); }
    .actions { display: flex; flex-wrap: wrap; gap: 0.55rem; margin-top: 0.8rem; }
    .msg { padding: 0.6rem; border-radius: var(--radius-sm); margin-top: 0.6rem; font-size: 0.85rem; }
    .msg.ok { background: rgba(34, 201, 151, 0.12); border: 1px solid var(--mint); color: var(--mint-dim); }
    .msg.err { background: rgba(255, 77, 34, 0.12); border: 1px solid var(--inferno); color: var(--inferno-dim); }
    .msg.info { background: var(--glow-ponzu); border: 1px solid var(--ponzu-dim); color: var(--ponzu); }

    .tier-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; }
    .tier-item {
      padding: 0.9rem;
      background: var(--bg);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
    }
    .tier-item .name { font-weight: 600; color: var(--ponzu); margin-bottom: 0.25rem; }
    .tier-item .price { font-family: 'JetBrains Mono', monospace; color: var(--mint); }
    .tier-item .members { color: var(--text-dim); font-size: 0.8rem; }

    .token-list { list-style: none; }
    .token-list li {
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-sm);
      padding: 0.7rem;
      margin-bottom: 0.5rem;
      font-size: 0.84rem;
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .token-list li:hover { background: var(--bg-panel); }
    .token-list .addr { color: var(--ponzu); word-break: break-all; }
    .config-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 0.65rem; font-size: 0.83rem; }
    .config-item { padding: 0.55rem; background: var(--bg); border-radius: var(--radius-sm); }
    .config-item .k { color: var(--text-dim); font-size: 0.76rem; }
    .config-item .v { font-family: 'JetBrains Mono', monospace; word-break: break-all; font-size: 0.8rem; }
    .ponzu { color: var(--ponzu); }
    .footer-note { text-align: center; font-size: 0.76rem; color: var(--text-dim); margin-top: 1.75rem; padding-top: 1rem; border-top: 1px solid var(--border-soft); }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="logo">PonzuCollectiva</div>
        <p class="tagline">MemeRevo · Burn meme tokens to ETH · Tiered membership club</p>
      </div>
      <div class="header-right">
        <span id="wallet-addr" class="wallet-addr">Not connected</span>
        <input type="text" id="contract-address" class="contract-in" placeholder="MemeRevo contract 0x..." />
        <button type="button" id="btn-connect" class="btn primary">Connect</button>
      </div>
    </header>

    <section class="hero">
      <h1>Meme revolution. Burn to ETH. Join the Collectiva.</h1>
      <p>Send whitelisted meme tokens into the inferno — they burn to ETH. Join tiered membership with ETH; earlier members earn from new joins. Referral rewards. Powered by MemeRevo.</p>
    </section>

    <div class="stats-row">
      <div class="stat-card"><div class="label">Inferno count</div><div class="value" id="stat-inferno">—</div></div>
      <div class="stat-card"><div class="label">Total members</div><div class="value ponzu" id="stat-members">—</div></div>
      <div class="stat-card"><div class="label">My tier</div><div class="value mint" id="stat-tier">—</div></div>
      <div class="stat-card"><div class="label">Collectiva</div><div class="value" id="stat-paused">—</div></div>
    </div>

    <div class="tabs">
      <button type="button" class="tab active" data-tab="inferno">Inferno burn</button>
      <button type="button" class="tab" data-tab="join">Join Collectiva</button>
      <button type="button" class="tab" data-tab="membership">My membership</button>
      <button type="button" class="tab" data-tab="tokens">Whitelisted tokens</button>
      <button type="button" class="tab" data-tab="stats">Stats</button>
      <button type="button" class="tab" data-tab="config">Config</button>
    </div>

    <div id="panel-inferno" class="panel visible">
      <div class="card">
        <h3>Burn meme tokens → ETH</h3>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 0.85rem;">Approve the MemeRevo contract for the token, then enter amount (in token units, 18 decimals). Tokens are burned or sent to burn pool; ETH from any swap is split vault/treasury.</p>
        <label>Token address (whitelisted)</label>
        <input type="text" id="inferno-token" class="input" placeholder="0x..." />
        <label>Amount (token units, e.g. 1000000000000000000 for 1)</label>
        <input type="text" id="inferno-amount" class="input" placeholder="Amount" />
        <div class="actions">
          <button type="button" id="btn-inferno" class="btn primary">Inferno burn</button>
        </div>
        <div id="inferno-msg" class="msg" style="display:none;"></div>
        <p style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.75rem;">Min and max burn amounts are set by the contract owner. Only whitelisted token addresses are accepted. You must have approved the MemeRevo contract to spend your tokens before calling Inferno burn.</p>
      </div>
    </div>

    <div id="panel-join" class="panel">
      <div class="card">
        <h3>Join the Collectiva</h3>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 0.85rem;">Pick a tier and pay in ETH. Part goes to existing members (ponzi-style), part to referral if set, rest to vault. One membership per address.</p>
        <label>Tier (1–4 default: Bronze, Silver, Gold, Diamond)</label>
        <select id="join-tier">
          <option value="1">1 — Bronze</option>
          <option value="2">2 — Silver</option>
          <option value="3">3 — Gold</option>
          <option value="4">4 — Diamond</option>
        </select>
        <label>Referrer address (optional)</label>
        <input type="text" id="join-referrer" class="input" placeholder="0x... or leave empty" />
        <label>Required ETH (shown from contract)</label>
        <input type="text" id="join-price-display" class="input" placeholder="—" readonly />
        <p id="join-referral-estimate" style="font-size: 0.82rem; color: var(--text-dim); margin-top: 0.25rem;">Referral reward (if referrer set): —</p>
        <div class="actions">
          <button type="button" id="btn-join" class="btn ponzu">Join Collectiva</button>
        </div>
        <div id="join-msg" class="msg" style="display:none;"></div>
      </div>
      <div class="card">
        <h4>Tier overview</h4>
        <div class="tier-grid" id="tier-grid"></div>
      </div>
    </div>

    <div id="panel-membership" class="panel">
      <div class="card">
        <h3>My membership</h3>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 0.75rem;">Your tier, join block, total paid, total earned from payouts, referrer.</p>
        <div class="actions"><button type="button" id="btn-refresh-membership" class="btn ponzu small">Refresh</button></div>
        <div id="membership-content"></div>
        <div id="membership-empty" style="display:none; color: var(--text-dim); font-size: 0.9rem;">Not a member. Join from the Join Collectiva tab.</div>
      </div>
      <div class="card">
        <h4>My burn stats</h4>
        <div id="burn-stats-content" style="color: var(--text-dim); font-size: 0.85rem;">—</div>
      </div>
    </div>

    <div id="panel-tokens" class="panel">
      <div class="card">
        <h3>Whitelisted meme tokens</h3>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 0.75rem;">Only these tokens can be sent to the inferno. Owner adds/removes via contract.</p>
        <div class="actions"><button type="button" id="btn-refresh-tokens" class="btn ponzu small">Refresh</button></div>
        <ul id="tokens-list" class="token-list"></ul>
        <div id="tokens-empty" style="display:none; color: var(--text-dim);">No whitelisted tokens or contract not set.</div>
        <p style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.5rem;">Use a token address from this list in the Inferno burn tab.</p>
      </div>
    </div>

    <div id="panel-stats" class="panel">
      <div class="card">
        <h3>Contract stats</h3>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 0.75rem;">Inferno sequence, tier snapshot sequence, min/max burn, referral BPS, and active tier count. Refreshed when you open this tab.</p>
        <div id="stats-content"></div>
      </div>
    </div>

    <div id="panel-config" class="panel">
      <div class="card">
        <h3>MemeRevo config</h3>
        <p style="color: var(--text-dim); font-size: 0.88rem; margin-bottom: 0.75rem;">Min/max burn, referral BPS, active tiers, paused. Immutable: vault, treasury, burn pool, referral hub; guardian is rotatable.</p>
        <div class="config-grid" id="config-grid"></div>
        <h4>Addresses</h4>
        <div class="config-grid">
          <div class="config-item"><span class="k">Vault</span><div class="v" id="cfg-vault">—</div></div>
          <div class="config-item"><span class="k">Treasury</span><div class="v" id="cfg-treasury">—</div></div>
          <div class="config-item"><span class="k">Burn pool</span><div class="v" id="cfg-burnpool">—</div></div>
          <div class="config-item"><span class="k">Guardian</span><div class="v" id="cfg-guardian">—</div></div>
          <div class="config-item"><span class="k">Referral hub</span><div class="v" id="cfg-referralhub">—</div></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top: 1.25rem;">
      <h3>How it works</h3>
      <ul style="color: var(--text-dim); font-size: 0.88rem; line-height: 1.7; margin-left: 1.25rem;">
        <li><strong class="ponzu">Inferno:</strong> Approve the MemeRevo contract for your meme token (ERC20), then call infernoBurn(token, amount). Tokens are burned or sent to the burn pool; min/max amounts apply.</li>
        <li><strong class="ponzu">Join:</strong> Send the tier join price in ETH via joinCollectiva(tierId, referrer). You cannot join twice. Referrer gets a percentage; the rest is split between existing members in your tier and the vault.</li>
        <li><strong class="ponzu">Tiers:</strong> Higher tiers cost more and allocate a larger share to members. Owner can add or deactivate tiers; guardian can emergency-pause the collectiva.</li>
      </ul>
    </div>

    <div class="card" style="margin-top: 1rem;">
      <h3>About PonzuCollectiva</h3>
      <p style="color: var(--text-dim); font-size: 0.9rem; line-height: 1.6;">PonzuCollectiva is the web interface for the MemeRevo (MRV) contract. MemeRevo is a meme revolution platform: send whitelisted meme tokens into the inferno — they are burned or forwarded to the burn pool; any ETH from conversions is split between vault and treasury. Join the Collectiva with ETH: choose a tier (Bronze, Silver, Gold, Diamond). A share of your payment goes to existing members in your tier (ponzi-style), a referral cut to your referrer if set, and the rest to the vault. One membership per address. Guardian can emergency-pause; owner manages whitelist and tier config. Safe for EVM mainnets when deployed with verified addresses.</p>
      <p style="color: var(--text-dim); font-size: 0.82rem; margin-top: 0.6rem;">Constants: MRV_BPS_BASE 10000, MRV_MAX_TIERS 8, MRV_MAX_REFERRAL_BPS 1500, MRV_MAX_BURN_BATCH 16. Immutable: vault, treasury, burn pool, referral hub. Guardian is rotatable by owner.</p>
      <p style="color: var(--text-dim); font-size: 0.8rem; margin-top: 0.4rem;">This UI does not hold keys or custody; all transactions are signed in your wallet. Verify the contract address before joining or burning.</p>
    </div>

    <p class="footer-note">PonzuCollectiva · MemeRevo (MRV) · Burn meme tokens to ETH · Tiered membership · Not financial advice. Verify contract on-chain before use.</p>
  </div>

  <script>
    (function () {
      const ABI = [
        'function getConfig() view returns (uint256 minBurn_, uint256 maxBurn_, uint256 referralBps_, uint8 activeTierCount_, bool paused_)',
        'function getTierInfo(uint8 tierId) view returns (uint256 joinPriceWei, uint256 shareBps, bool active, uint256 memberCount, uint256 totalCollectedWei)',
        'function getMemberInfo(address account) view returns (uint8 tierId, uint256 joinedAtBlock, uint256 totalPaidWei, uint256 totalEarnedWei, address referrer)',
        'function getWhitelistedTokens() view returns (address[])',
        'function getMemberCount() view returns (uint256)',
        'function infernoSequence() view returns (uint256)',
        'function joinCollectiva(uint8 tierId, address referrer) payable',
        'function infernoBurn(address token, uint256 amount) returns (uint256 ethOut)',
        'function hasJoined(address account) view returns (bool)',
        'function getBurnStats(address account) view returns (uint256 totalBurnedWei, uint256 burnCount, uint256 totalEthOut)',
        'function getImmutableAddresses() view returns (address vault_, address treasury_, address burnPool_, address guardian_, address referralHub_)',
        'function tierSnapshotSequence() view returns (uint256)',
        'function collectivaPaused() view returns (bool)',
        'function getTierName(uint8 tierId) view returns (string memory)',
        'function contractBalance() view returns (uint256)'
      ];
      let provider = null;
      let signer = null;
      let userAddress = null;
      let contractAddress = null;

      const contractIn = document.getElementById('contract-address');
      const walletEl = document.getElementById('wallet-addr');
      const statInferno = document.getElementById('stat-inferno');
      const statMembers = document.getElementById('stat-members');
      const statTier = document.getElementById('stat-tier');
      const statPaused = document.getElementById('stat-paused');

      function showMsg(id, text, type) {
        const el = document.getElementById(id);
        if (!el) return;
        el.textContent = text;
        el.className = 'msg ' + (type || 'info');
        el.style.display = 'block';
      }
      function hideMsg(id) { const el = document.getElementById(id); if (el) el.style.display = 'none'; }
      function getContractAddr() { return (contractIn.value || '').trim() || contractAddress; }

      function getContract(readOnly) {
        const addr = getContractAddr();
        if (!addr) return null;
        return new ethers.Contract(addr, ABI, readOnly !== false ? (provider || ethers.getDefaultProvider()) : signer);
      }

      async function connectWallet() {
        try {
          if (!window.ethereum) { showMsg('inferno-msg', 'No Ethereum provider.', 'err'); return; }
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          if (accounts.length) {
            userAddress = accounts[0];
            walletEl.textContent = userAddress.slice(0, 6) + '…' + userAddress.slice(-4);
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            if (contractIn.value.trim()) contractAddress = contractIn.value.trim();
            await refreshStats();
          }
        } catch (e) { showMsg('inferno-msg', e.message || 'Connect failed', 'err'); }
      }

      async function refreshStats() {
        const c = getContract(true);
        if (!c) {
          statInferno.textContent = '—';
          statMembers.textContent = '—';
          statTier.textContent = '—';
          statPaused.textContent = '—';
          return;
        }
        try {
          const cfg = await c.getConfig();
          const memberCount = await c.getMemberCount();
          const infernoSeq = await c.infernoSequence();
          statInferno.textContent = infernoSeq.toString();
          statMembers.textContent = memberCount.toString();
          statPaused.textContent = cfg.paused_ ? 'Paused' : 'Active';
          if (userAddress) {
            const joined = await c.hasJoined(userAddress);
            if (joined) {
              const info = await c.getMemberInfo(userAddress);
              const name = await c.getTierName(info[0]).catch(() => 'Tier ' + info[0]);
              statTier.textContent = name;
            } else statTier.textContent = '—';
          } else statTier.textContent = '—';
        } catch (e) {
          statInferno.textContent = '—';
          statMembers.textContent = '—';
          statTier.textContent = '—';
          statPaused.textContent = '—';
        }
      }

      document.getElementById('btn-connect').addEventListener('click', connectWallet);

      document.querySelectorAll('.tab').forEach(function (tab) {
        tab.addEventListener('click', function () {
          document.querySelectorAll('.tab').forEach(function (t) { t.classList.remove('active'); });
          document.querySelectorAll('.panel').forEach(function (p) { p.classList.remove('visible'); });
          tab.classList.add('active');
          const id = 'panel-' + tab.getAttribute('data-tab');
          const panel = document.getElementById(id);
          if (panel) panel.classList.add('visible');
          if (id === 'panel-join') loadJoinPanel();
          if (id === 'panel-membership') loadMembership();
          if (id === 'panel-tokens') loadTokens();
          if (id === 'panel-stats') loadStats();
          if (id === 'panel-config') loadConfig();
        });
      });

      async function updateJoinPrice() {
        const tier = parseInt(document.getElementById('join-tier').value, 10) || 1;
        const el = document.getElementById('join-price-display');
        const refEl = document.getElementById('join-referral-estimate');
        const c = getContract(true);
        if (!c) {
          el.placeholder = 'Set contract';
          if (refEl) refEl.textContent = 'Referral reward (if referrer set): —';
          return;
        }
        try {
          const info = await c.getTierInfo(tier);
          const eth = ethers.formatEther(info.joinPriceWei);
          el.placeholder = eth + ' ETH';
          const cfg = await c.getConfig();
          const refBps = Number(cfg.referralBps_ || 0);
          const refWei = (info.joinPriceWei * BigInt(refBps)) / BigInt(10000);
          if (refEl) refEl.textContent = 'Referral reward (if referrer set): ' + ethers.formatEther(refWei) + ' ETH';
        } catch (_) {
          el.placeholder = '—';
          if (refEl) refEl.textContent = 'Referral reward (if referrer set): —';
        }
      }
      document.getElementById('join-tier').addEventListener('change', updateJoinPrice);

      async function loadTierGrid() {
        const grid = document.getElementById('tier-grid');
        grid.innerHTML = '';
        const c = getContract(true);
        if (!c) return;
        try {
          const cfg = await c.getConfig();
          const maxTiers = Number(cfg.activeTierCount_ || 4);
          for (let tierId = 1; tierId <= maxTiers; tierId++) {
            const info = await c.getTierInfo(tierId);
            if (!info.active) continue;
            const name = await c.getTierName(tierId).catch(() => 'Tier ' + tierId);
            const div = document.createElement('div');
            div.className = 'tier-item';
            div.innerHTML = '<div class="name">' + name + '</div><div class="price">' + ethers.formatEther(info.joinPriceWei) + ' ETH</div><div class="members">Members: ' + info.memberCount.toString() + ' · Share BPS: ' + info.shareBps.toString() + '</div>';
            grid.appendChild(div);
          }
        } catch (_) {}
      }

      async function loadJoinPanel() {
        await updateJoinPrice();
        await loadTierGrid();
      }

      document.getElementById('btn-join').addEventListener('click', async function () {
        hideMsg('join-msg');
        const c = getContract(false);
        if (!c || !userAddress) { showMsg('join-msg', 'Connect wallet and set contract.', 'err'); return; }
        const tierId = parseInt(document.getElementById('join-tier').value, 10) || 1;
        let referrer = (document.getElementById('join-referrer').value || '').trim();
        if (!referrer) referrer = '0x0000000000000000000000000000000000000000';
        try {
          const info = await c.getTierInfo(tierId);
          const tx = await c.joinCollectiva(tierId, referrer, { value: info.joinPriceWei });
          showMsg('join-msg', 'Tx sent: ' + tx.hash, 'info');
          await tx.wait();
          showMsg('join-msg', 'Joined Collectiva.', 'ok');
          await refreshStats();
          loadTierGrid();
        } catch (e) { showMsg('join-msg', e.message || 'Join failed', 'err'); }
      });

      document.getElementById('btn-inferno').addEventListener('click', async function () {
        hideMsg('inferno-msg');
        const c = getContract(false);
        if (!c || !userAddress) { showMsg('inferno-msg', 'Connect wallet and set contract.', 'err'); return; }
        const token = (document.getElementById('inferno-token').value || '').trim();
        const amountStr = (document.getElementById('inferno-amount').value || '').trim();
        if (!token || !amountStr) { showMsg('inferno-msg', 'Enter token address and amount.', 'err'); return; }
        let amount;
        try { amount = BigInt(amountStr); } catch (_) { showMsg('inferno-msg', 'Invalid amount.', 'err'); return; }
        try {
          const tx = await c.infernoBurn(token, amount);
          showMsg('inferno-msg', 'Tx sent: ' + tx.hash, 'info');
          const rec = await tx.wait();
          showMsg('inferno-msg', 'Burned. Tx: ' + rec.hash, 'ok');
          await refreshStats();
        } catch (e) { showMsg('inferno-msg', e.message || 'Inferno failed', 'err'); }
      });

      async function loadMembership() {
        const content = document.getElementById('membership-content');
        const empty = document.getElementById('membership-empty');
        const burnEl = document.getElementById('burn-stats-content');
        content.innerHTML = '';
        const c = getContract(true);
        if (!c || !userAddress) {
          empty.style.display = 'block';
          burnEl.textContent = '—';
          return;
        }
        try {
          const joined = await c.hasJoined(userAddress);
          if (!joined) {
            empty.style.display = 'block';
            burnEl.textContent = '—';
            return;
          }
          empty.style.display = 'none';
          const info = await c.getMemberInfo(userAddress);
          const name = await c.getTierName(info[0]).catch(() => 'Tier ' + info[0]);
          let html = '<p><strong>Tier:</strong> ' + name + '</p>';
          html += '<p><strong>Joined at block:</strong> ' + info.joinedAtBlock.toString() + '</p>';
          html += '<p><strong>Total paid:</strong> ' + ethers.formatEther(info.totalPaidWei) + ' ETH</p>';
          html += '<p><strong>Total earned:</strong> ' + ethers.formatEther(info.totalEarnedWei) + ' ETH</p>';
          html += '<p><strong>Referrer:</strong> ' + (info.referrer || '—') + '</p>';
          content.innerHTML = html;
          const burnStats = await c.getBurnStats(userAddress);
          burnEl.textContent = 'Total burned (wei): ' + burnStats[0].toString() + ', Burn count: ' + burnStats[1].toString();
        } catch (e) {
          content.innerHTML = '<p class="msg err">' + (e.message || 'Load failed') + '</p>';
          burnEl.textContent = '—';
        }
      }

      document.getElementById('btn-refresh-membership').addEventListener('click', loadMembership);

      async function loadTokens() {
        const list = document.getElementById('tokens-list');
        const empty = document.getElementById('tokens-empty');
        list.innerHTML = '';
        const c = getContract(true);
        if (!c) {
          empty.style.display = 'block';
          return;
        }
        try {
          const tokens = await c.getWhitelistedTokens();
          if (!tokens || tokens.length === 0) {
            empty.style.display = 'block';
            return;
          }
          empty.style.display = 'none';
          tokens.forEach(function (addr) {
            if (addr === '0x0000000000000000000000000000000000000000') return;
            const li = document.createElement('li');
            li.innerHTML = '<span class="addr">' + addr + '</span>';
            list.appendChild(li);
          });
        } catch (e) {
          empty.style.display = 'block';
